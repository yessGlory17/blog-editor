<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/style.css">
    <script src="./jquery/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/1389171202.js" crossorigin="anonymous"></script>
    
</head>
<body>
    <div class="editor">
        <div class="editor-left"></div>
        <div class="editor-main">

            <!-- <div class="image-upload">
                <form action="" method="post" enctype="multipart/form-data" id="upload-image">
                    <div class="preview">
                        <img src="" alt="" class="preview-image">
                        
                    </div>
                    <input type="file" class="input-file">
                    <input class="upload-image-button" type="button" value="Upload">
                        <a href="#" id="image-upload-link">
                            <i class="fas fa-upload" id="upload-image-icon"></i>
                        </a>
                    </input>
                </form>
            </div> -->
    
    
            <!-- <div class="link-dialog">
                <input class="link-dialog-input" type="text" placeholder="Lütfen Linki Buraya Giriniz.">
                <button class="link-dialog-button">
                    <i class="fas fa-check"></i>
                </button>
            </div> -->
           <!--Düzenleme Butonları!-->
            <div class="select-text-box">
                <button class="select-text-box-bold-button">
                    <!-- <a href="#" id="bold-button-link" class="select-text-box-bold-button"> -->
                        <i class="fas fa-bold"></i>
                    <!-- </a> -->
                </button>
                <button class="select-text-box-italic-button">
                   <!-- <a href="#" id="italic-button-link"> -->
                        <i class="fas fa-italic"></i>
                   <!-- </a> -->
                </button>
                <button class="select-text-box-link-button">
                    <!-- <a href="#" id="link-button"> -->
                        <i class="fas fa-link"></i>
                    <!-- </a> -->
                </button>
                <button class="select-text-box-quote-button" id="content-quote-button">
                    <!-- <a href="#" id="quote-button-link" class="select-text-box-quote-button"> -->
                        <i class="fas fa-quote-right"></i>
                    <!-- </a> -->
                </button>
                <button class="select-text-box-underline-button" id="content-quote-button">
                    <a href="#" id="underline-button-link">
                        <i class="fas fa-underline"></i>
                    </a>
                </button>
                <button class="select-text-box-highlighter-button" id="content-quote-button">
                    <a href="#" id="highlighter-button-link">
                        <i class="fas fa-highlighter"></i>
                    </a>
                </button>
                <button class="select-text-box-list-ul-button" id="content-quote-button">
                    <a href="#" id="list-ul-button-link">
                        <i class="fas fa-list-ul"></i>
                    </a>
                </button>
                <!-- <button class="select-text-box-image-button" id="content-quote-button">
                    <a href="#" id="image-button-link">
                        <i class="fas fa-image"></i>
                    </a>
                </button> -->
    
                <form action="" method="post" enctype="multipart/form-data" id="upload-image2">
                    <label class="custom-image-upload">
                        <input type="file" id="yukle">
                        <i id="upload-icon" class="fas fa-image"></i>
                    </label>
                </form>
            </div>
            <!--Düzenleme Butonları-->
    
            <div class="text-header-container">
                <div class="editor-section-container">
                    <div class="editor-buttons" >
                        <button class="plus-button" id="header-plus-button">
                            <i class="fas fa-plus"></i>   
                        </button>
                        <button class="image-button" id="header-image-button">
                            <i class="fas fa-image"></i>
                        </button>
                        <button class="link-button" id="header-link-button">
                            <i class="fas fa-link"></i>
                        </button>
                    </div>
                    <p class="editor-section-text" >
                        Title
                    </p>
                </div>
               <div class="vertical-line">
                    
                </div> 
                <div class="text-header-flex-container">
                    <div class="header-input-flex-container-content">
                        <div contenteditable="true" class="header-input" placeholder="Buraya Başlığı Giriniz"></div>
                        
                    </div>
                </div>
                
           </div>
           <div class="content-header-container">
            <div class="editor-section-container">
                <div class="editor-buttons">
                    <button class="plus-button" id="content-plus-button">
                        <i class="fas fa-plus"></i>   
                    </button>
                    <button class="image-button" id="content-image-button">
                        <i class="fas fa-image"></i>
                    </button>
                    <button class="link-button" id="content-link-button">
                        <i class="fas fa-link"></i>
                    </button>
                    
                </div>
                <p class="editor-section-text" >
                    Content
                </p>
            </div>
           <div class="vertical-line">
                
            </div> 
            <div class="text-header-flex-container">
                <div class="content-input-flex-container-content">
                    <div contenteditable="true" class="header-input" id="content-input" placeholder="Burada hikayeni anlat!"></div>
                    
                </div>
            </div>
            
       </div>
           
                
            
    
        </div>
        <div class="editor-right"></div>
    </div>
    <script>
        
         $(document).ready(function(){

            //Burada editöre bir metin yapıştırılırsa onu kendi stilinde yapıştırmasını sağlıyorum. Yoksa seçilen metinin özellikleri gelir!
            $('[contenteditable]').on('paste',function(e) {
        
                e.preventDefault();
                
                var text = (e.originalEvent || e).clipboardData.getData('text/html');
                var $result = $(this).append($(text));
                
                $(this).html($result.html());
                
                // Burada kalın ve italik hariç tüm stilleri değiştiriyorum.
                $.each($(this).find("*"), function(idx, val) {
                    var $item = $(val);
                    if ($item.length > 0){
                    var saveStyle = {
                            'font-weight': $item.css('font-weight'),
                            'font-style': $item.css('font-style')
                        };
                        $item.removeAttr('style').removeClass()
                        .css(saveStyle); 
                    }
                });
                
                //Gereksiz etiketleri kaldırıyorum.
                $(this).children('style').remove();
                $(this).children('meta').remove()
                $(this).children('link').remove();
                
            });
            
            


             $(".header-input").on("focusout",function(){
               
               //Başlık girişi inputundan çıktığında bölge ismini kapatır ve seçenek butonunu açar!
                $(".editor-section-text").css("display","none");
                $(".editor-buttons").css("display","flex");

             })


             //Artı butonuna basıldığında diğer içerik ekleme butonlarını gösterir
             var editorButtons1Show = false; //Editor butonunun görünürlüğünü kontrol eder.
             $("#header-plus-button").click(function(){
                 //alert();
                if(!editorButtons1Show){
                    // $(".image-button").css("display","block");
                    // $(".link-button").css("display","block");
                    $("#header-image-button").fadeIn(500);
                    $("#header-link-button").fadeIn(500);

                    editorButtons1Show = !editorButtons1Show;

                }else{

                    // $(".image-button").css("display","none")
                    // $(".link-button").css("display","none")

                    $("#header-image-button").fadeOut(500);
                    $("#header-link-button").fadeOut(500);

                    editorButtons1Show = !editorButtons1Show;
                }
             })

             //İçerik + butonunu kontrol eder.
             var editorButtons2Show = false;
             $("#content-plus-button").click(function(){
                 //alert();
                if(!editorButtons2Show){
                    // $(".image-button").css("display","block");
                    // $(".link-button").css("display","block");
                    
                    $("#content-image-button").fadeIn(500);
                    $("#content-link-button").fadeIn(500);

                    editorButtons2Show = !editorButtons2Show;

                }else{

                    // $(".image-button").css("display","none")
                    // $(".link-button").css("display","none")

                    $("#content-image-button").fadeOut(500);
                    $("#content-link-button").fadeOut(500);

                    editorButtons2Show = !editorButtons2Show;
                }
             })


             //Yazı Seçme ve Düzenleme
             var secilenYazi = null;
             var linkText = '';//Linke yazıyı aktarma
             $(".header-input").on("mouseup",function(event){
                
                
                //secilenYazi = YaziyiSec();
                secilenYazi = document.getSelection() || document.selection.createRange();
                //linkText = YaziyiSec();
                //console.log(secilenYazi);
                //alert(secilenYazi);

                var mPos = {
                    x  : event.pageX,
                    y : event.pageY
                };

                if(secilenYazi != ''){
                    $(".select-text-box").fadeIn(500)
                    $(".select-text-box").offset({
                        top: event.pageY - 100,
                        left : event.pageX - 100
                    });
                    
                    //Yazıyı Düzenlenmek İçin Kalınlaştırma Butonu
                    $(".select-text-box-bold-button").on("click",function(){
                        //e.preventDefault();
                        //Yazıyı Kalınlaştıracak Fonksiyonu çağırıyoruz.
                        format('bold');
                    })

                    //Yazıyı Düzenlemek İçin Yanaeğme Butonu
                    $(".select-text-box-italic-button").click(function(){

                        //Yazıyı Yanaeğik Yapacak Fonksiyonu Çağırıyoruz.
                        //e.preventDefault();
                        format('italic');

                        console.log(YaziyiSec())
                    })

                    $(".select-text-box-quote-button").click(function(){
                        //console.log(secilenYazi);
                        //e.preventDefault();
                        addBloquete(document.getSelection() || document.selection.createRange());
                    })

                    $(".select-text-box-link-button").click(function(e){
                        //Link ekler
                        var alinanLink = prompt("Linki buraya giriniz : ");
                        setUrl(YaziyiSec(),alinanLink);
                    });

                    $(".select-text-box-underline-button").click(function(e){
                        //alert();
                        //e.preventDefault();
                        format('underline');
                    });

                    $(".select-text-box-highlighter-button").click(function(e){
                        //alert();
                        //e.preventDefault();
                        if(document.execCommand("HiliteColor",false,"#FFFC33")){
                            document.execCommand("HiliteColor",false,"#FFFC33");
                        }

                        
                    });

                    $(".select-text-box-list-ul-button").click(function(e){
                        alert();
                        
                        //format('insertunorderedlist');
                        document.execCommand('insertOrderedList',false,YaziyiSec());
                        
                        
                    });

                    
                    //Alıntı kısmı takılı kalıyor o bug'ı çözmek için!
                    $('[contenteditable]').on("keyup", function(e){

                        //alert("Enter!");
                        if (e.which || e.keyCode === 13) {
                            if (document.queryCommandValue('formatBlock') === 'blockquote') {
                                document.execCommand('formatBlock',0, '<p>')
                            }
                        }

                    });

                    
                    /*
                    *İlk olarak image button yapısı değiştirilecek!
                    *Daha sonra css uygulanacak!
                    *Ardından jQuery kodu doğrudan o butonun tetiklenmesine dayanacak!
                    */
                    //Upload tetikleme!
                    
                    $("#yukle").change(function(){

                        
                        var fd = new FormData();
                        var files = $('#yukle')[0].files;
                        //alert(files[0].name);
                        // Check file selected or not
                        if(files.length > 0 ){
                        fd.append('file',files[0]);

                        $.ajax({
                            url: 'backend/imageupload.php',
                            type: 'post',
                            data: fd,
                            contentType: false,
                            processData: false,
                            success: function(response){
                                console.log(response);
                                console.log(files[0].name);
                                if(response != 0){
                                    //$(".preview-image").attr("src",response); 
                                    //$(".image-upload").fadeOut(500);
                                    
                                    var host = "https://localhost";
                                    var image =  host + "/Editor/uploads/" +files[0].name;
                                    console.log("Added Image Url : " + image);
                                    $("#content-input").focus();
                                    //document.execCommand('insertImage',0,image)
                                    document.execCommand('insertHTML', 0, '<img class="post-image" src="' + image + '"  /> </img>');

                                }else{
                                    //alert('Dosya Yüklenemedi');
                                }
                            },
                        });
                        }else{
                            alert("Lütfen Dosya seç!");
                        }
                    
                    })

                    secilenYazi = '';
                }else{
                    $(".select-text-box").fadeOut(1000)
                    //$(".link-dialog").fadeOut(1000)
                }
             })


             //Yazı Seçme Fonksiyonu
             function YaziyiSec(){
                 
                if (window.getSelection) {
                    return window.getSelection();
                } else if (document.selection) {
                    return document.selection.createRange();
                }
                return '';

             }


             //Yazıyı Düzenleme Fonksiyonu
             function format(command,value){
                 //alert();
                 document.execCommand(command,false,value);
             }


            
             function setUrl(secilen, adres){
                //alert("Set Url Çalıştı")
                //Bu fonksiyonun amacı metin düzenlemede link eklemek istendiği zaman bu link girişi yapıldığında linki yazıya eklemek.
                
                var url = adres;
                var sText = secilen;
                console.log(sText);
                document.execCommand('insertHTML', false, '<a href="' + url + '" >' + sText + '</a>');
                //document.getElementById(linkDialogText).value = '';


                // $(".link-dialog-button").click(function(){
                //     alert($(".link-dialog-input").val())
                //     var linkDialogText = $(".link-dialog-input").val();
                //     if(linkDialogText != ''){
                //         confirm("Bu boş değil");
                        
                //     }
                // })
             }


             //Bu fonksiyonun amacı metinde alıntı eklemektir.
             function addBloquete(secilen){
                
                var secilenText = secilen;
                if(secilenText != ''){
                    //alert("Boş yakalandı!");
                    document.execCommand('insertHTML', false, '<blockquote class="alinti">' + secilenText + '</blockquote>');
                }
                //alert(secilenText[0])
                
             }

             //Buradaki amaç link eklemek için basıldığında gelen inputun pozisyonunu link butonunun pozisyonuna eşitleyerek yana yana görünmesini sağlamak.
             $(".select-text-box-link-button").click(function(event){
                //alert(); 
                //$(".link-dialog").fadeIn(1000);

                //var dialogPosition = $(".select-text-box-link-button").offset();
                
                // $(".link-dialog").offset({
                //     top: dialogPosition.top,
                //     left : dialogPosition.left + 45
                // })
             })

             
         })
    </script>
</body>
</html>